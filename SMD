import pandas as pd
import numpy as np

def standardized_mean_diff(df, treat_col, covariates):
    treated = df[df[treat_col]==1]
    control = df[df[treat_col]==0]

    smd = {}
    for cov in covariates:
        mean_t = treated[cov].mean()
        mean_c = control[cov].mean()
        var_t = treated[cov].var()
        var_c = control[cov].var()

        smd[cov] = (mean_t - mean_c) / np.sqrt((var_t + var_c) / 2)
    return pd.Series(smd)

# Example
smd_results = standardized_mean_diff(matched_df, "treatment", ["age","bmi","bp"])
print(smd_results)


import matplotlib.pyplot as plt

smd_before = standardized_mean_diff(original_df, "treatment", ["age","bmi","bp"])
smd_after = standardized_mean_diff(matched_df, "treatment", ["age","bmi","bp"])

plt.figure(figsize=(6,4))
plt.scatter(smd_before.index, smd_before.values, label="Before Matching", color="red")
plt.scatter(smd_after.index, smd_after.values, label="After Matching", color="blue")
plt.axhline(0.1, color="gray", linestyle="--")
plt.axhline(-0.1, color="gray", linestyle="--")
plt.xticks(rotation=45)
plt.ylabel("Standardized Mean Difference")
plt.legend()
plt.show()

